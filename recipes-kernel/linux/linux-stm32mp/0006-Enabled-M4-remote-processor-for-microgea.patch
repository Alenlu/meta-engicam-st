From 3375ced850181b8e4e7e4cbe81b2e0dc34d7891b Mon Sep 17 00:00:00 2001
From: frautel <francesco.utel@engicam.com>
Date: Thu, 25 Nov 2021 11:33:21 +0100
Subject: [PATCH] Enabled M4 remote processor for microgea

---
 arch/arm/boot/dts/stm32mp157a-ugea512-m4.dts | 62 ++++++++++++++++++++
 1 file changed, 62 insertions(+)
 create mode 100644 arch/arm/boot/dts/stm32mp157a-ugea512-m4.dts

diff --git a/arch/arm/boot/dts/stm32mp157a-ugea512-m4.dts b/arch/arm/boot/dts/stm32mp157a-ugea512-m4.dts
new file mode 100644
index 000000000..b69deab86
--- /dev/null
+++ b/arch/arm/boot/dts/stm32mp157a-ugea512-m4.dts
@@ -0,0 +1,62 @@
+// SPDX-License-Identifier: (GPL-2.0+ OR BSD-3-Clause)
+/*
+ * Copyright (C) STMicroelectronics 2017 - All Rights Reserved
+ * Author:
+ */
+
+/dts-v1/;
+
+#include "stm32mp157a-ugea512-mx.dts"
+
+/ {
+	model = "STMicroelectronics STM32MP157C-DK2 configured to run M4 examples";
+	compatible = "st,stm32mp157a-ugea512", "stm32mp157a-ugea512-mx", "st,stm32mp157";
+};
+
+&adc {
+	status = "disabled";
+};
+
+&dac {
+	status = "disabled";
+};
+
+&dma2 {
+	status = "disabled";
+};
+
+&dmamux1 {
+	dma-masters = <&dma1>;
+	dma-channels = <8>;
+};
+
+&ipcc {
+        status = "okay";
+};
+
+&m4_rng2 {
+	status = "okay";
+};
+
+&m4_rproc {
+	m4_system_resources {
+		status = "okay";
+	};
+};
+
+&m4_rproc {
+        memory-region = <&retram>, <&mcuram>, <&mcuram2>, <&vdev0vring0>,
+                <&vdev0vring1>, <&vdev0buffer>;
+        mboxes = <&ipcc 0>, <&ipcc 1>, <&ipcc 2>;
+        mbox-names = "vq0", "vq1", "shutdown";
+        interrupt-parent = <&exti>;
+        interrupts = <68 1>;
+        interrupt-names = "wdg";
+        wakeup-source;
+        recovery;
+        status = "okay";
+};
+
+&timers1 {
+	status = "disabled";
+};
