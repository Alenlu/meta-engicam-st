From 0ab68480da40e80d1698f102996c0d613496855a Mon Sep 17 00:00:00 2001
From: Franesco Utel <francesco.utel@engicam.com>
Date: Wed, 1 Jun 2022 14:14:08 +0200
Subject: [PATCH] Enabled can peripheral on Microdev expander

---
 arch/arm/boot/dts/stm32mp157a-ugea512-mx.dts | 31 ++++++++++++++++++++
 1 file changed, 31 insertions(+)

diff --git a/arch/arm/boot/dts/stm32mp157a-ugea512-mx.dts b/arch/arm/boot/dts/stm32mp157a-ugea512-mx.dts
index 9c5052ef1..0f93c0b05 100644
--- a/arch/arm/boot/dts/stm32mp157a-ugea512-mx.dts
+++ b/arch/arm/boot/dts/stm32mp157a-ugea512-mx.dts
@@ -336,6 +336,26 @@
 		};
 	};
 
+	fdcan2_pins_mx: fdcan2_mx-0 {
+		pins1 {
+			pinmux = <STM32_PINMUX('B', 5, AF9)>; /* FDCAN2_RX */
+			bias-disable;
+		};
+		pins2 {
+			pinmux = <STM32_PINMUX('B', 6, AF9)>; /* FDCAN2_TX */
+			bias-disable;
+			drive-push-pull;
+			slew-rate = <0>;
+		};
+	};
+
+	fdcan2_sleep_pins_mx: fdcan2_sleep_mx-0 {
+		pins {
+			pinmux = <STM32_PINMUX('B', 5, ANALOG)>, /* FDCAN2_RX */
+					 <STM32_PINMUX('B', 6, ANALOG)>; /* FDCAN2_TX */
+		};
+	};
+
 	fmc_pins_mx: fmc_mx-0 {
 		u-boot,dm-pre-reloc;
 		pins1 {
@@ -993,6 +1013,16 @@
 	/* USER CODE END ltdc */
 };
 
+&m_can2{
+	pinctrl-names = "default", "sleep";
+	pinctrl-0 = <&fdcan2_pins_mx>;
+	pinctrl-1 = <&fdcan2_sleep_pins_mx>;
+	status = "okay";
+
+	/* USER CODE BEGIN m_can2 */
+	/* USER CODE END m_can2 */
+};
+
 &mdma1{
 	status = "okay";
 
@@ -1211,3 +1241,4 @@
 
 /* USER CODE BEGIN addons */
 /* USER CODE END addons */
+
